!function(e){e.fn.datagrid=function(t){function i(){var t="<thead></thead><tbody></tbody>";e(P).append(t)}function n(){var t="<tr id='thead-merge-cells'></tr>";if(e(P).find("thead").append(t),1==C.rowNumber){var i="<th sortable='false' style='text-align: center; width: 20px;' rowspan='2'>No</th>";e(P).find("#thead-merge-cells").append(i)}if(1==C.rowCheck){var n="<th sortable='false' style='text-align: center; width: 20px;' rowspan='2'><input type='checkbox'></th>";e(P).find("#thead-merge-cells").append(n),u()}C.columns.forEach(function(t,i){var n=!1,a="",r="",l="";C.mergeCells.forEach(function(e){i==e.index&&(n=!0,a=e.align,r=e.colspan,l=e.title)}),n||C.mergeCells.forEach(function(e){i>e.index&&i<e.index+e.colspan&&(n=null)});var o="";n?o="<th sortable='false' style='text-align: "+a+";' colspan='"+r+"'>"+l+"</th>":0==n&&(o="<th title='"+t.field+"' sortable='"+t.sortable+"' style='text-align: "+t.align+"; width: "+t.width+"px;' rowspan='2'>"+t.title+"</th>"),e(P).find("#thead-merge-cells").append(o)})}function a(){var t="<tr id='thead-title'></tr>";if(e(P).find("thead").append(t),1==C.rowNumber&&0==C.mergeCells.length){var i="<th sortable='false' style='text-align: center; width: 20px;'>No</th>";e(P).find("#thead-title").append(i)}if(1==C.rowCheck&&0==C.mergeCells.length){var n="<th sortable='false' style='text-align: center; width: 20px;'><input type='checkbox'></th>";e(P).find("#thead-title").append(n),u()}C.columns.forEach(function(t,i){var n=!1;C.mergeCells.length>0?C.mergeCells.forEach(function(e){i>=e.index&&i<e.index+e.colspan&&(n=!0)}):n=!0;var a;n&&(a="<th title='"+t.field+"' sortable='"+t.sortable+"' style='text-align: "+t.align+"; width: "+t.width+"px;'>"+t.title+"</th>"),e(P).find("#thead-title").append(a)})}function r(t,i,n){var a,r=e.extend({limit:parseInt(t)*i-i,offset:i,sort:C.sortBy,order:C.orderBy,dataSearch:n},C.queryParams);return e.ajax({url:C.url,async:!1,type:"post",dataType:"json",data:r,success:function(e){a=e}}),a}function l(t){var i=C.columns.length+(s()+1),n="<tr><td colspan='"+i+"' style='text-align: center;'>"+t+"</td></tr>";e(P).find("tbody").html(n)}function o(t,i,n){l("Loading data..."),k=r(t,i,n);var a=parseInt(t)*i-i+1,o="";if(k.total>=1){for(var h=0;h<k.rows.length;h++)o+="<tr>",C.rowNumber&&(o+="<td style='text-align: center;'>"+a+"</td>"),C.rowCheck&&(o+="<td style='text-align: center;'><input value='"+k.rows[h][C.primaryField]+"' type='checkbox'></td>"),C.columns.forEach(function(e){o+=void 0!=k.rows[h][e.field]?"<td style='text-align: "+e.align+"; width: "+e.width+"px;'>"+k.rows[h][e.field]+"</td>":"<td style='text-align: "+e.align+"; width: "+e.width+"px;'>"+e.rowStyler(k.rows[h],h)+"</td>"}),o+="</tr>",a++;e(P).find("tbody").html(o)}else l("No records found...");c(t,i),d(),v(t,i)}function c(t,i){var n="";n+='<li title="first"><a href="javascript:void(0);">First</a></li>',n+='<li title="prev"><a href="javascript:void(0);">Prev</a></li>',t==Math.ceil(k.total/i)&&t-2>=1&&(n+='<li title="'+(t-2)+'"><a href="javascript:void(0);">'+(t-2)+"</a></li>"),t-1>=1&&(n+='<li title="'+(t-1)+'"><a href="javascript:void(0);">'+(t-1)+"</a></li>"),n+='<li class="active" title="'+t+'"><a href="javascript:void(0);">'+t+"</a></li>",t+1<=Math.ceil(k.total/i)&&(n+='<li title="'+(t+1)+'"><a href="javascript:void(0);">'+(t+1)+"</a></li>"),1==t&&Math.ceil(k.total/i)>2&&(n+='<li title="'+(t+2)+'"><a href="javascript:void(0);">'+(t+2)+"</a></li>"),n+='<li title="next"><a href="javascript:void(0);">Next</a></li>',n+='<li title="last"><a href="javascript:void(0);">Last</a></li>',e(C.pagingElement).html(n),e(C.pagingElement).children("li").each(Math.ceil(k.total/i)>1?function(){e(this).on("click",function(){"prev"==this.title&&t-1>=1?(o(t-1,i,m()),C.activePageNumber--):"next"==this.title&&t+1<=Math.ceil(k.total/i)?(o(t+1,i,m()),C.activePageNumber++):"first"==this.title?(o(1,i,m()),C.activePageNumber=1):"last"==this.title?(o(Math.ceil(k.total/i),i,m()),C.activePageNumber=Math.ceil(k.total/i)):(parseInt(this.title)<=t+2||parseInt(this.title)>=t-2)&&(o(parseInt(this.title),i,m()),C.activePageNumber=this.title)})}:function(){e(this).off()})}function h(){for(var t="",i=0;i<C.itemsPerPageOption.length;i++)t+="<option value='"+C.itemsPerPageOption[i]+"'>"+C.itemsPerPageOption[i]+"</option>";e(C.optionPagingElement).html(t),e(C.optionPagingElement).val(C.itemsPerPage),e(C.optionPagingElement).on("change",function(){C.itemsPerPage=e(C.optionPagingElement).children("option:selected").val(),o(1,C.itemsPerPage,m())})}function s(){var e=-1;return 1==C.rowNumber?e+=1:"",1==C.rowCheck?e+=1:"",e}function d(){e(P).children("tbody").children("tr").each(function(){e(this).children().each(function(t){t==s()&&e(this).children().each(function(){for(var t=0;t<C.rowChecked.length;t++)C.rowChecked[t]==e(this).attr("value")&&e(this).prop("checked",!0);e(this).on("click",function(){for(var e,t=!1,i=0;i<C.rowChecked.length;i++)C.rowChecked[i]==this.value&&(t=!0,e=i);t?C.rowChecked.splice(e,1):C.rowChecked[C.rowChecked.length]=parseInt(this.value),p()})})})}),p()}function p(){for(var t=e(P).children("thead").find('input[type="checkbox"]'),i=f(),n=!0,a=0;a<i.length;a++)e(i[a]).prop("checked")||(n=!1);n?t.prop("checked",!0):t.prop("checked",!1)}function f(){var t=[];return e(P).children("tbody").children("tr").each(function(){e(this).children().each(function(i){i==s()&&e(this).children().each(function(){t[t.length]=e(this)})})}),t}function u(){var t=e(P).children("thead").find('input[type="checkbox"]');e(t).on("click",function(){var t=f();if(e(this).prop("checked"))for(var i=0;i<t.length;i++){e(t[i]).prop("checked",!0);for(var n,a=!1,r=0;r<C.rowChecked.length;r++)C.rowChecked[r]==e(t[i]).attr("value")&&(a=!0,n=r);a||(C.rowChecked[C.rowChecked.length]=parseInt(e(t[i]).attr("value")))}else for(var i=0;i<t.length;i++){e(t[i]).prop("checked",!1);for(var n,a=!1,r=0;r<C.rowChecked.length;r++)C.rowChecked[r]==e(t[i]).attr("value")&&(a=!0,n=r);a&&C.rowChecked.splice(n,1)}})}function g(){C.columns.forEach(function(t){t.search&&e(C.searchFieldElement).append('<option value="'+t.field+'">'+t.title+"</option>")}),e(C.searchInputElement).on("keyup",function(){o(1,C.itemsPerPage,m())}),e(C.searchFieldElement).on("change",function(){o(1,C.itemsPerPage,m())})}function m(){var t=e(C.searchFieldElement).val(),i=e(C.searchInputElement).val(),n="";return n=""==i?"":{field:t,value:i}}function v(t,i){if(k.total>=1){var n,a;n=t*i-i+1,a=t==Math.ceil(k.total/i)?t*i-(t*i-k.total):t*i,e(C.pageInfoElement).html("Showing "+n+" - "+a+" of "+k.total+" entries")}else e(C.pageInfoElement).html("Showing 0 - 0 of 0 entries")}function x(){e(P).children("thead").children().children().each(function(t,i){if("false"!=e(i).attr("sortable")){var n=e("<span></span>");e(n).css({width:"0px",height:"0px",border:"4px solid transparent","border-bottom":"5px solid #ccc",position:"absolute","margin-left":"5px","margin-top":"0px"}),e(this).append(n);var a=e("<span></span>");e(a).css({width:"0px",height:"0px",border:"4px solid transparent","border-top":"5px solid #ccc",position:"absolute","margin-left":"5px","margin-top":"11px"}),e(this).append(a)}})}function w(){C.sortBy=C.primaryField,x(),e(P).children("thead").children().children().each(function(t,i){"false"!=e(i).attr("sortable")&&(e(this).css("cursor","pointer"),e(this).on("click",function(){e(P).children("thead").children().children().each(function(){e(this).children("span").remove()}),x();var t=e("<span></span>");e(this).append(t),null==e(this).attr("data-sortby")||"DESC"==e(this).attr("data-sortby")?(e(this).attr("data-sortby","ASC"),e(this).children("span").css({width:"0px",height:"0px",border:"4px solid transparent","border-bottom":"5px solid #333",position:"absolute","margin-left":"5px","margin-top":"3px"})):(e(this).attr("data-sortby","DESC"),e(this).children("span").css({width:"0px",height:"0px",border:"4px solid transparent","border-top":"5px solid #333",position:"absolute","margin-left":"5px","margin-top":"7px"})),C.sortBy=this.title,C.orderBy=e(this).attr("data-sortby"),o(C.activePageNumber,C.itemsPerPage,m())}))})}function b(t,i,n,a,r,l){if(i>s()){var o,c;if(C.columns.forEach(function(e,t){t+s()+1==i&&(o=e.editable,c=e.field)}),o){var h,o=e(t).html(),d=a(c,o);if(C.columns.forEach(function(e,t){e.editable&&(h=t)}),"active"!=e(t).attr("inline-edit"))e(t).attr("inline-edit","active"),e(t).html("<form>"+d+"</form>"),h+s()+1==i&&r();else{e(t).attr("inline-edit","not-active");var p=e(t).children("form").serializeArray();e(t).html(p[0].value),k.rows[n][c]=p[0].value,h+s()+1==i&&l()}}}}function y(t,i,n,a,r,l){e(t).children().each(function(t){"all"==i?b(e(this),t,n,a,r,l):t==i+s()+1&&b(e(this),t,n,a,r,l)})}var P=e(this),k=[],C=e.extend({url:"",primaryField:"",sortBy:"",orderBy:"DESC",pagingElement:"",optionPagingElement:"",searchFieldElement:"",searchInputElement:"",pageInfoElement:"",rowNumber:!1,rowCheck:!1,columns:[],mergeCells:[],activePageNumber:1,itemsPerPage:5,itemsPerPageOption:[5,10,15,20],rowChecked:[],queryParams:{}},t);return this.reload=function(){o(C.activePageNumber,C.itemsPerPage,m())},this.getChecked=function(){return C.rowChecked},this.setChecked=function(e){for(var t=0;t<e.length;t++){for(var i=!1,n=0;n<C.rowChecked.length;n++)C.rowChecked[n]==e[t]&&(i=!0);i||(C.rowChecked[C.rowChecked.length]=e[t])}o(C.activePageNumber,C.itemsPerPage,m())},this.setUnchecked=function(e){for(var t=0;t<e.length;t++){for(var i,n=!1,a=0;a<C.rowChecked.length;a++)C.rowChecked[a]==e[t]&&(n=!0,i=a);n&&C.rowChecked.splice(i,1)}o(C.activePageNumber,C.itemsPerPage,m())},this.getRowData=function(e){return"all"==e?k.rows:k.rows[e]},this.editable=function(t){var i=e.extend({rowIndex:"all",columnIndex:"all",styler:function(e,t){return t},onEdit:function(){console.log("Edited")},onSave:function(){console.log("Saved")}},t);e(P).children("tbody").children().each(function(t){"all"==i.rowIndex?y(e(this),i.columnIndex,t,i.styler,i.onEdit,i.onSave):t==i.rowIndex&&y(e(this),i.columnIndex,t,i.styler,i.onEdit,i.onSave)})},this.queryParams=function(t){C.queryParams=e.extend(C.queryParams,t)},this.run=function(){i(),C.mergeCells.length>0&&n(),a(),w(),o(C.activePageNumber,C.itemsPerPage,m()),h(),g()},this}}(jQuery);