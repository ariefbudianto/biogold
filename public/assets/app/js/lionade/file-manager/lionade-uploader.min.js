!function(i){i.fn.uploader=function(e){function n(){var e='<div class="file"><div class="toolbar-menu"><ul><li title="select-file" class="active">Media Library</li><li title="upload-file">Upload Files</li></ul></div><div class="content"><div class="wp-title"><span id="title">Insert Media</span><span id="close">x</span></div><div class="wp-images"></div><div class="wp-uploader hde"><div class="wp-loading"><div class="fill"></div></div><div class="file-upload"><span>Select File</span><input type="file" class="upload"></div><p>Maximum upload file size: 128 MB.</p></div><div class="wp-button"><button>Select File</button></div></div></div>';i(s).html(e),i(s).find(".wp-button").children("button").on("click",function(){i(s).fadeOut()}),i(s).find(".wp-title").children("#close").on("click",function(){i(s).fadeOut()})}function t(){i(s).find(".toolbar-menu").children("ul").children("li").each(function(){i(this).on("click",function(){i(s).find(".toolbar-menu").children("ul").children("li").each(function(){i(this).removeClass("active")}),"upload-file"==i(this).attr("title")?(i(this).addClass("active"),i(s).find(".wp-images").fadeOut(function(){i(s).find(".wp-uploader").fadeIn()})):(i(this).addClass("active"),i(s).find(".wp-uploader").fadeOut(function(){i(s).find(".wp-images").fadeIn()}))})})}function a(){i.post(o.scan_url).done(function(e){i(s).find(".wp-images").html("");for(var n=0;n<e.length;n++){var t=i('<img title="'+e[n]+'" src="'+o.image_directory+e[n]+'">');i(s).find(".wp-images").append(t),i(t).on("click",function(){i(s).find("img").each(function(){i(this).removeClass("active")}),i(this).addClass("active"),o.selected_image=this.title})}d()})}function l(){i(s).find('input[type="file"]').on("change",function(){var e=i.ajaxSettings.xhr;i.ajaxSetup({progress:i.noop,xhr:function(){var i=e(),n=this;return i.upload.addEventListener("progress",function(i){i.lengthComputable&&n.progress(i)},!1),i}});var n=new FormData;i(s).find("input[type=file]").each(function(){n.append("files[]",this.files[0])}),i(s).find(".wp-loading").fadeIn(function(){i(s).find(".file-upload").fadeOut(function(){i(s).find(".wp-uploader").children("p").fadeOut(function(){i.ajax({url:o.upload_url,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,complete:function(e){var e=JSON.parse(e.responseText);if("success"==e.message){o.selected_image=e.image,i(s).find(".wp-loading").fadeOut(),i(s).find(".file-upload").fadeIn(),i(s).find(".wp-uploader").children("p").fadeIn(),i(s).find(".toolbar-menu").children("ul").children("li").each(function(){"upload-file"==i(this).attr("title")?i(this).removeClass("active"):i(this).addClass("active"),i(s).find(".wp-uploader").fadeOut(function(){i(s).find(".wp-images").fadeIn(),a()})});var n=i(s).find('input[type="file"]');n.replaceWith(n.val("").clone(!0)),console.log("Completed.")}else alert(e.message)},progress:function(e){e.lengthComputable?(i(s).find(".fill").css("width",parseInt(e.loaded/e.total*100,10)+"%"),console.log("Uploaded "+parseInt(e.loaded/e.total*100,10)+"%")):console.log("Length not computable.")}})})})})})}function d(){i(s).find(".wp-images").children("img").each(function(){i(this).attr("title")==o.selected_image&&i(this).addClass("active")})}var s=i(this),o=i.extend({scan_url:"",upload_url:"",selected_image:"",image_directory:""},e);return this.show=function(){i(s).fadeIn()},this.on_select_image=function(e){i(s).find(".wp-button").children("button").on("click",function(){e(o.selected_image)})},this.run=function(){n(),t(),a(),l()},this}}(jQuery);